<!doctype html>
<html lang="tr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Zatürre Tespiti</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet" />
    <style>
      .hero {
        background: radial-gradient(1200px circle at 10% 10%, rgba(255, 255, 255, 0.25), transparent 60%),
          linear-gradient(135deg, #0d6efd 0%, #6f42c1 100%);
      }
      .hero-card {
        backdrop-filter: blur(10px);
        background: rgba(255, 255, 255, 0.12);
        border: 1px solid rgba(255, 255, 255, 0.2);
      }
      .soft-shadow {
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
      }
      .muted-mini {
        font-size: 0.9rem;
        opacity: 0.9;
      }
      .result-badge {
        font-size: 0.9rem;
        letter-spacing: 0.02em;
      }
    </style>
  </head>
  <body class="bg-light">
    <header class="hero text-white py-5">
      <div class="container">
        <div class="row align-items-center g-4">
          <div class="col-lg-7">
            <div class="d-flex align-items-center gap-2 mb-3">
              <span class="badge text-bg-light text-dark"><i class="bi bi-cpu"></i> Deep Learning</span>
              <span class="badge text-bg-light text-dark"><i class="bi bi-image"></i> Chest X-Ray</span>
            </div>
            <h1 class="display-6 fw-semibold mb-2">Zatürre (Pneumonia) Tespiti</h1>
            <p class="lead muted-mini mb-0">
              X-ray görüntüsü yükle, model tahminini ve sınıf olasılıklarını anında gör.
            </p>
          </div>
          <div class="col-lg-5">
            <div class="p-4 rounded-4 hero-card">
              <div class="d-flex gap-3 align-items-start">
                <div class="fs-3"><i class="bi bi-shield-check"></i></div>
                <div>
                  <div class="fw-semibold">Demo Arayüz</div>
                  <div class="muted-mini">Bu çıktı klinik tanı yerine geçmez. Karar destek amaçlıdır.</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </header>

    <main class="container py-5">
      <div class="row justify-content-center">
        <div class="col-lg-10 col-xl-9">

          {% with messages = get_flashed_messages() %}
            {% if messages %}
              <div class="alert alert-warning soft-shadow border-0">
                {% for message in messages %}
                  <div>{{ message }}</div>
                {% endfor %}
              </div>
            {% endif %}
          {% endwith %}

          <div class="card border-0 rounded-4 soft-shadow mb-4">
            <div class="card-body p-4 p-md-5">
              <div class="d-flex align-items-center justify-content-between flex-wrap gap-3 mb-3">
                <div>
                  <div class="h5 mb-1">Görüntü Yükle</div>
                  <div class="text-muted">Model: <span class="fw-semibold">{{ (result.checkpoint if result else 'outputs_v2/best.pt') }}</span></div>
                </div>
                <div class="text-muted"><i class="bi bi-lightning-charge"></i> Hızlı tahmin</div>
              </div>
              <form action="{{ url_for('predict') }}" method="post" enctype="multipart/form-data">
                <div class="mb-3">
                  <label class="form-label">X-ray Görüntüsü</label>
                  <input class="form-control form-control-lg" type="file" name="file" accept="image/png,image/jpeg,image/webp" required />
                  <div class="form-text">Desteklenen: png, jpg, jpeg, webp</div>
                </div>
                <div class="d-flex gap-2 flex-wrap">
                  <button class="btn btn-primary btn-lg" type="submit"><i class="bi bi-search"></i> Tahmin Et</button>
                  <a class="btn btn-outline-secondary btn-lg" href="{{ url_for('index') }}"><i class="bi bi-arrow-counterclockwise"></i> Sıfırla</a>
                </div>
              </form>
            </div>
          </div>

          {% if result %}
            <div class="card border-0 rounded-4 soft-shadow overflow-hidden">
              <div class="card-body p-4 p-md-5">
                <div class="row g-4 align-items-start">
                  <div class="col-lg-6">
                    <div class="d-flex align-items-center justify-content-between mb-2">
                      <h2 class="h5 mb-0">Tahmin Sonucu</h2>
                      <span class="badge rounded-pill result-badge {% if result.pred == 'PNEUMONIA' %}text-bg-danger{% else %}text-bg-success{% endif %}">
                        <i class="bi {% if result.pred == 'PNEUMONIA' %}bi-exclamation-triangle-fill{% else %}bi-check-circle-fill{% endif %}"></i>
                        {{ result.pred }}
                      </span>
                    </div>

                    <div class="p-3 rounded-3 bg-body-tertiary border">
                      <div class="d-flex justify-content-between align-items-center">
                        <div class="text-muted">Güven Skoru</div>
                        <div class="fw-semibold">{{ (result.prob * 100) | round(2) }}%</div>
                      </div>
                      <div class="progress mt-2" role="progressbar" aria-label="Confidence" aria-valuenow="{{ (result.prob * 100) | round(2) }}" aria-valuemin="0" aria-valuemax="100">
                        <div class="progress-bar {% if result.pred == 'PNEUMONIA' %}bg-danger{% else %}bg-success{% endif %}" style="width:0%;" data-pct="{{ (result.prob * 100) | round(2) }}"></div>
                      </div>
                    </div>

                    <hr />

                    <h3 class="h6 mb-3">Sınıf Olasılıkları</h3>
                    {% for cls, p in result.probs.items() %}
                      <div class="mb-3">
                        <div class="d-flex justify-content-between align-items-center">
                          <div class="fw-medium">
                            <i class="bi {% if cls == 'PNEUMONIA' %}bi-virus{% else %}bi-heart-pulse{% endif %}"></i>
                            {{ cls }}
                          </div>
                          <div class="text-muted">{{ (p * 100) | round(2) }}%</div>
                        </div>
                        <div class="progress" role="progressbar" aria-label="{{ cls }}" aria-valuenow="{{ (p * 100) | round(2) }}" aria-valuemin="0" aria-valuemax="100">
                          <div class="progress-bar" style="width:0%;" data-pct="{{ (p * 100) | round(2) }}" data-cls="{{ cls }}"></div>
                        </div>
                      </div>
                    {% endfor %}

                    <hr />
                    <div class="small text-muted"><i class="bi bi-hdd"></i> Checkpoint: {{ result.checkpoint }}</div>
                    <div class="small text-muted"><i class="bi bi-gpu-card"></i> Device: {{ result.device }}</div>
                  </div>
                  <div class="col-lg-6">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                      <h2 class="h5 mb-0">Yüklenen Görüntü</h2>
                      <span class="badge text-bg-secondary"><i class="bi bi-image"></i> Preview</span>
                    </div>
                    {% if image_url %}
                      <div class="p-2 rounded-4 bg-white border soft-shadow">
                        <img src="{{ image_url }}" alt="Uploaded" class="img-fluid rounded-3" />
                      </div>
                    {% endif %}
                  </div>
                </div>
              </div>
            </div>
          {% endif %}

          <div class="mt-4">
            <div class="card border-0 rounded-4 soft-shadow">
              <div class="card-body p-4 d-flex gap-3 align-items-start">
                <div class="fs-4 text-primary"><i class="bi bi-info-circle"></i></div>
                <div>
                  <div class="fw-semibold">Uyarı</div>
                  <div class="text-muted">
                    Bu uygulama yalnızca demo amaçlıdır; tıbbi tanı yerine geçmez.
                  </div>
                </div>
              </div>
            </div>
            <div class="text-center text-muted small mt-3">
              <span>© {{ 2026 }} • Kemal Alper AKDENİZ</span>
            </div>
          </div>
        </div>
      </div>
    </main>
    <script>
      (function () {
        var bars = document.querySelectorAll('.progress-bar[data-pct]');
        for (var i = 0; i < bars.length; i++) {
          var pct = parseFloat(bars[i].getAttribute('data-pct') || '0');
          if (!isFinite(pct)) pct = 0;
          if (pct < 0) pct = 0;
          if (pct > 100) pct = 100;
          var cls = (bars[i].getAttribute('data-cls') || '').toUpperCase();
          if (cls === 'PNEUMONIA') {
            bars[i].classList.add('bg-danger');
          } else if (cls === 'NORMAL') {
            bars[i].classList.add('bg-success');
          } else {
            bars[i].classList.add('bg-primary');
          }
          bars[i].style.width = pct.toFixed(2) + '%';
        }
      })();
    </script>
  </body>
</html>
